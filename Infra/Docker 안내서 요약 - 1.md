## 서버를 관리한다는 것
- 설치가 어렵다 😂
  - Redhat Linux에 oracle 설치하기는 생각보다 쉽지 않다. 오히려 힘들다.
  - 어렵게 설치한 서버의 버전을 업데이트 하는건 엄청난 리스크
  - 최대한 건드리지 않는게 최선의 방법
- 하지만 매번 바뀌어야한다. 그리고 그 주기는 더 빨라진다. 😥
  - CentOS -> Ubuntu
  - AWS -> Azure 와 같은 방식
  - Chef의 cookbook -> Ansible의 playbook
  - DevOps의 등장으로 개발주기가 짧아짐 -> 배포가 자주 이루어짐 -> 마이크로서비스 아키텍처
  - 프로그램은 더 잘게 쪼개지고 관리가 더 복잡해짐, 새로운 툴은 계속 등장
- 이때 Docker가 등장

## 도커의 역사
- 2013년 3월 pycon에서 solomon hykes가 "리눅스컨테이너의 미래"라는 세션을 발표
- 회사명을 Docker로 변경
- 2014년 6월 도커 1.0 발표
- 2014년 8월 dotCloud 플랫폼 매각, 도커 집중을 위해
- 2015년 4월 1100억원 투자 유치 후
- 2016년 
    - 90%가 개발에 사용중
    - 80%가 DevOps에서 사용할 예정
    - 58%가 운영환경에서 사용중

## 도커란?
- 정의 : 컨테이너 기반의 오픈소스 가상화 플랫폼
  - 컨테이너란? 
    - ```다양한 프로그램, 실행환경```을 컨테이너라는 이름으로 ```추상화하고 동일한 인터페이스를 제공```해, ```배포 및 관리를 단순하게 해줌```
    - 백엔드 프로그램, 데이터베이스 서버, 메시지 큐등 어떤 프로그램도 컨테이너로 추상화 할 수 있음
    - 조립 PC , AWS , Azure,  GCP등 어디에서든 실행 가능
  - 기존의 방식
    - 호스트 OS 위에 게스트 OS 전체를 가상화하여 사용
    - 장점 : 여러 OS 사용 가능, 사용법 간단
    - 단점 : 느림 따라서 운영환경 사용 X
  - 개선의 방식
    - CPU의 가상화 기술(HVM)을 이용한 KVM( kernel-based Virtual Machine)
    - 반가상화 (Paravirtualization) 방식의 Xen
    - 게스트OS가 필요하긴 하지만 전체 OS 모두를 가상화하진 않는 방식
  - 컨테이너 방식
    - 프로세스의 격리를 통해 하나의 서버에 여러개의 컨테이너를 실행
    - 장점 : CPU와 메모리는 딱 필요한 만큼만 추가로 사용 + 성능적 손실이 거의 없음
    > 도커의 기본 네트워크 모드는 ```Brige모드``` , 네트워크 성능이 중요하다면 ```--net=host``` 옵션을 고려
    - 사용적 이점
      - 실행중인 컨테이너에 접속해 명령어를 입력 가능 
      - ```apt-get```, ```yum``` 패키지 설치 가능
      - 사용자 추가 가능
      - 여러개의 프로세스를 백그라운드로 실행 가능
      - CPU나 메모리 사용량 제한 가능
      - 호스트의 특정 포트와 연결
      - 호스트의 특정 디렉토리를 내부 디렉토리인것 처럼 사용 가능
      - 생성시간 1 ~ 2초 ```가상머신 대비 엄청나게 빠름```
    - 컨테이너 방식의 역사
      - 리눅스에서의 ```cgroup``` 
      - namespace를 이용한 ```LXC(Linux container)```
      - FreeBSD에선 ```jail```
      - Solaris에서는 ```Solaris Zones```
      - Google에서 ```lmctfy(Let me Contain That For you)```라는 오픈소스 컨테이너 기술을 공개 but 성공하진 못함
      - Docker는 ```LXC```를 기반으로 시작해서 libcontainer 기술을 사용했고 , runC 기술에 합쳐짐?
- 도커 image
  - 정의 : 컨테이너 실행에 필요한 파일과 설정값등을 포함하고 있는것
  - 컨테이너는 이미 실행한 상태, 같은 이미지에서 여러개의 컨테이너를 생성 컨테이너의 상태가 바뀌거나 삭제되더라도 이미지는 변하지 않음(Immutable)
    - Ubuntu 이미지는 ubuntu 실행을 위한 모든 파일을 가지고 있음
    - MySql 이미지는 debian을 기반으로 실행하기위한 파일과 실행명령어 , 포트 정보등을 가지고 있음
    - Gitlab 이미지는 centOS를 기반으로 ruby, go, database, redis, gitlab source, nginx등을 가지고 있음
  - 따라서 이미지는 컨테이너 실행을 위한 모든 정보를 가지고 있기때문에 ```의존성파일을 컴파일하고 이것저것 설치할 필요가 없음```
  - Docker hub에 등록하거나 Docker Registry저장소를 직접 만들어 관리할수도 있음

## 핫한 이유
- 이미 존재하는 기술을 잘 포장
  - 컨테이너, 오버레이 네트워크, 유니온 파일 시스템 등 이미 존재하는 기술을 도커처럼 잘 조합하고 사용하기 쉽게 만든 것은 없었음
  - ```사용자들이 쓰기 쉽게``` 간단하지만 획기적인 아이디어로 구현
### 레이어방식
- 도커 이미지는 컨테이너를 실행하기 위한 ```모든 정보```를 가지고 있기 때문에 용량이 수백메가에 이름
- 처음 이미지 다운받을땐 크게 부담이 안되지만 기존 이미지에 파일하나 추가했다고 수백메가를 다시 다운받는다면 ```매우 비효율```
- 이 문제를 해결하기 위해 ```레이어```라는 방식을 사용
- ```유니온 파일 시스템```을 이용해 ```여러개의 레이어를 하나의 파일시스템으로 사용``` 할 수 있게 해줌
  - ubuntu 이미지 :  A + B + C 집합이라고 가정
  - nginx 이미지 추가 : A + B + C + nginx
  - webapp 이미지( nginx 기반) 추가 : A + B + C + nginx + source
  - webapp 수정 : A + B + C + nginx + source(v2)
    - A, B, C, nginx 레이어를 제외한 새로운 레이어만 다운로드
    - 효율적
- 컨테이너 생성시 기존의 이미지 레이어 위에 읽기/쓰기 레이어 추가
  - 컨테이너가 실행중에 생성한 파일이나 변경된 애용은 읽기/쓰기 레이어에 저장되므로 여러개의 컨테이너를 생성해도 최소한의 용량만 사용
   
### 이미지 경로
- 이미지는 URL방식으로 관리하며 태그를 붙일 수 있음
- 이를 이용하면 따라서 테스트나 롤백등을 쉽게 할수 있음
  - ```ubuntu:14.04```를 사용하다가 ```ubuntu:16.04```를 바로 사용 가능
   
### Dockerfile
```
# vertx/vertx3 debian version
FROM subicura/vertx3:3.3.1
MAINTAINER chungsub.kim@purpleworks.co.kr

ADD build/distributions/app-3.3.1.tar /
ADD config.template.json /app-3.3.1/bin/config.json
ADD docker/script/start.sh /usr/local/bin/
RUN ln -s /usr/local/bin/start.sh /start.sh

EXPOSE 8080
EXPOSE 7000

CMD ["start.sh"]
```
- DSL(Domain-specific language)언어를 이용해 이미지 생성과정을 적을 수 있음
- 서버에 어떤 프로그램을 설치하려고 이것저것 의존성 패키지를 설치하고 설정파일을 만들던 것을 기록
  - 이 파일은 소스와 함께 버전 관리
  - 누구나 이미지 생성과정을 보고 수정할 수 있음
   
### Docker Hub
- 공개 이미지를 ```무료```로 관리 해줌
- 공짜는 좋은것..
   
### Command와 API
- Docker 클라이언트는 명령어가 잘만들어 져있음
- http기반의 RestAPI도 지원하여 확정성이 굉장히 좋고 훌륭한 3rd party툴이 나오기 좋은 환경
   
### 유용한 새로운 기능들
- 발전속도가 굉장히 빠름
- 1.13버전
  - Docker Statcks 여러 컨테이너를 한번에 관리하는 기능 릴리즈
  - System 커맨드 추가 되어 이미지, 컨테이너 관리가 더 편해짐
  - Secrets Management 비밀정보 관리하는 기능도 추가

### 훌륭한 생태계
- 도커 기반의 오픈소스 10만개가 넘음
   
### 커뮤니티 지원과 귀여운 로고
- 도커 회사 자체가 홍보와 커뮤니티에 신경을 많이 씀
  - 커뮤니티를 위한 굿즈
  - 연사 요청 가능
  - 전세계 밋업 상황을 볼수 있음
  - 일주일마다 개발자들 글을 뉴스레터로 발행함
- 고래가 귀엽다.

 
